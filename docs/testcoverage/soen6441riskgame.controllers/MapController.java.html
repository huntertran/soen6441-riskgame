<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MapController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">soen6441riskgame</a> &gt; <a href="index.source.html" class="el_package">soen6441riskgame.controllers</a> &gt; <span class="el_source">MapController.java</span></div><h1>MapController.java</h1><pre class="source lang-java linenums">package soen6441riskgame.controllers;

import java.io.FileWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.stream.Collectors;

import soen6441riskgame.enums.CommonCommandArgs;
import soen6441riskgame.enums.MapPart;
import soen6441riskgame.models.Continent;
import soen6441riskgame.models.Coordinate;
import soen6441riskgame.models.Country;
import soen6441riskgame.singleton.GameBoard;
import soen6441riskgame.utils.ConsolePrinter;
import soen6441riskgame.utils.GraphChecker;

/**
 * Control the map
 */
<span class="fc" id="L25">public final class MapController {</span>
    private static final int MINIMUM_AMOUNT_OF_COUNTRIES = 6;

    /**
     * add border from country to others country
     *
     * @param countryOrder        the location of first country in the border graph
     * @param borderWithCountries the location of other countries in the border graph
     */
    private void addBorders(int countryOrder, int... borderWithCountries) {
<span class="fc" id="L35">        int[][] graph = GameBoard.getInstance().getGameBoardMap().getBorders();</span>
<span class="fc bfc" id="L36" title="All 2 branches covered.">        for (int index = 0; index &lt; borderWithCountries.length; index++) {</span>
<span class="fc" id="L37">            graph[countryOrder - 1][borderWithCountries[index] - 1] = 1;</span>
<span class="fc" id="L38">            graph[borderWithCountries[index] - 1][countryOrder - 1] = 1;</span>
        }
<span class="fc" id="L40">    }</span>

    /**
     * add new continent
     *
     * @param continentName
     * @param continentValue the amount of army for the new continent
     * @param order          the continent other in the list (start with 1 as the map file structure
     *                       indicate)
     */
    public void addContinent(String continentName, String continentValue, int... order) {
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">        if (!isContinentExisted(continentName)) {</span>
<span class="fc" id="L52">            GameBoard.getInstance()</span>
<span class="fc" id="L53">                     .getGameBoardMap()</span>
<span class="fc" id="L54">                     .getContinents()</span>
<span class="fc" id="L55">                     .add(new Continent(continentName, Integer.parseInt(continentValue)));</span>

<span class="fc" id="L57">            ConsolePrinter.printFormat(&quot;New continent added: %s with %s armies&quot;, continentName, continentValue);</span>
        } else {
<span class="nc" id="L59">            ConsolePrinter.printFormat(&quot;Continent with name %s existed&quot;, continentName);</span>
        }
<span class="fc" id="L61">    }</span>

    /**
     * add new country to an existed continent OR add existing country to an existed continent
     *
     * @param countryName   the new country name
     * @param continentName the existed continent name
     */
    public void addCountry(String countryName, String continentName) {
<span class="fc" id="L70">        Continent continent = getContinentFromName(continentName);</span>
<span class="fc" id="L71">        Country country = GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName);</span>

<span class="pc bpc" id="L73" title="1 of 2 branches missed.">        if (continent == null) {</span>
<span class="nc" id="L74">            ConsolePrinter.printFormat(&quot;Continent %s is not existed&quot;, continentName);</span>
<span class="nc" id="L75">            return;</span>
        }

<span class="pc bpc" id="L78" title="1 of 2 branches missed.">        if (country == null) {</span>
<span class="fc" id="L79">            createNewCountry(countryName, continent);</span>
        } else {
<span class="nc" id="L81">            continent.getCountries().add(country);</span>
        }

<span class="fc" id="L84">        ConsolePrinter.printFormat(&quot;Country %s is added to continent %s&quot;, countryName, continentName);</span>
<span class="fc" id="L85">    }</span>

    /**
     * add new country from map file
     *
     * @param order          the order of country in the list, start with 1
     * @param name           the country name (no space allowed)
     * @param continentOrder the other of the continent that new country belongs to
     * @param coordinate     the position of the country on a visual map (not used)
     */
    private void addCountryFromMapFile(String name, int continentOrder, Coordinate coordinate) {
<span class="fc bfc" id="L96" title="All 2 branches covered.">        for (Continent continent : GameBoard.getInstance().getGameBoardMap().getContinents()) {</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">            if (continent.getOrder() == continentOrder) {</span>
<span class="fc" id="L98">                Country country = new Country(name, coordinate, continent);</span>
<span class="fc" id="L99">                updateCountryContinent(country, continent);</span>
            }
<span class="fc" id="L101">        }</span>
<span class="fc" id="L102">    }</span>

    /**
     * connect 2 countries with each other on the borderGraph
     *
     * @param countryName
     * @param neighborCountryName
     */
    public void addNeighbor(String countryName, String neighborCountryName) {
<span class="fc" id="L111">        Country country = GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName);</span>
<span class="fc" id="L112">        Country neighbor = GameBoard.getInstance().getGameBoardMap().getCountryFromName(neighborCountryName);</span>

<span class="pc bpc" id="L114" title="2 of 4 branches missed.">        if (country == null || neighbor == null) {</span>
<span class="nc" id="L115">            System.out.println(&quot;The country name or neighbor country name is not existed!&quot;);</span>
<span class="nc" id="L116">            return;</span>
        }

<span class="fc" id="L119">        addBorders(country.getOrder(), neighbor.getOrder());</span>
<span class="fc" id="L120">    }</span>

    /**
     * create new country, add it to the borderGraph
     *
     * @param countryName
     * @param continent   the name of continent that country belong to
     */
    public void createNewCountry(String countryName, Continent continent) {
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        if (GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName) != null) {</span>
<span class="nc" id="L130">            return;</span>
        }

<span class="fc" id="L133">        int newBorderSize = GameBoard.getInstance().getGameBoardMap().getCountries().size() + 1;</span>

<span class="fc" id="L135">        Country newCountry = new Country(countryName, new Coordinate(0, 0), continent);</span>

<span class="fc" id="L137">        increaseBorder(newBorderSize);</span>

<span class="fc" id="L139">        updateCountryContinent(newCountry, continent);</span>

<span class="fc" id="L141">        ConsolePrinter.printFormat(&quot;Country %s is created&quot;, countryName);</span>
<span class="fc" id="L142">    }</span>

    /**
     * Increase border
     *
     * @param newBorderSize location of the border to insert
     */
    private void increaseBorder(int newBorderSize) {
<span class="fc" id="L150">        int[][] originalBorder = GameBoard.getInstance().getGameBoardMap().getBorders();</span>
<span class="fc" id="L151">        int[][] newBorders = new int[newBorderSize][newBorderSize];</span>

<span class="fc bfc" id="L153" title="All 2 branches covered.">        for (int row = 0; row &lt; newBorderSize - 1; row++) {</span>
<span class="fc" id="L154">            newBorders[row] = Arrays.copyOf(originalBorder[row], newBorderSize);</span>
<span class="fc" id="L155">            newBorders[newBorderSize - 1][row] = 0;</span>
        }

<span class="fc bfc" id="L158" title="All 2 branches covered.">        for (int col = 0; col &lt; newBorderSize; col++) {</span>
<span class="fc" id="L159">            newBorders[newBorderSize - 1][col] = 0;</span>
        }

<span class="fc" id="L162">        GameBoard.getInstance().getGameBoardMap().setBorders(newBorders);</span>
<span class="fc" id="L163">    }</span>

    /**
     * handle 'editcontient' command from console
     *
     * @param args -add continentName continentValue -remove continentName
     */
    public void editContinent(String[] args) {
<span class="fc" id="L171">        CommonCommandArgs continentCommand = CommonCommandArgs.fromString(args[0]);</span>

<span class="pc bpc" id="L173" title="3 of 4 branches missed.">        switch (continentCommand) {</span>
            case ADD: {
<span class="nc" id="L175">                addContinent(args[1], args[2]);</span>
<span class="nc" id="L176">                break;</span>
            }
            case REMOVE: {
<span class="fc" id="L179">                removeContinent(args[1]);</span>
<span class="fc" id="L180">                break;</span>
            }
            case NONE: {
<span class="nc" id="L183">                System.out.println(&quot;Incorrect command&quot;);</span>
<span class="fc" id="L184">                break;</span>
            }
        }
<span class="fc" id="L187">    }</span>

    /**
     * handle 'editcountry' command
     *
     * @param args -add countryName continentName -remove countryName
     */
    public void editCountry(String[] args) {
<span class="fc" id="L195">        CommonCommandArgs countryCommand = CommonCommandArgs.fromString(args[0]);</span>

<span class="pc bpc" id="L197" title="2 of 4 branches missed.">        switch (countryCommand) {</span>
            case ADD: {
<span class="fc" id="L199">                addCountry(args[1], args[2]);</span>
<span class="fc" id="L200">                break;</span>
            }
            case REMOVE: {
<span class="fc" id="L203">                removeCountry(args[1]);</span>
<span class="fc" id="L204">                break;</span>
            }
            case NONE: {
<span class="nc" id="L207">                System.out.println(&quot;Incorrect command&quot;);</span>
                break;
            }
        }
<span class="fc" id="L211">    }</span>

    public void editMap(String fileName) throws IOException {
        try {
<span class="nc" id="L215">            loadMap(fileName);</span>
<span class="nc" id="L216">        } catch (IOException e) {</span>
            // file not existed. Create new map
<span class="nc" id="L218">            saveMap(fileName);</span>
<span class="nc" id="L219">        }</span>
<span class="nc" id="L220">    }</span>

    /**
     * handle 'editneighbor' command
     *
     * @param args -add countryName neighborCountryName -remove countryName neighborCountryName
     */
    public void editNeighbor(String[] args) {
<span class="fc" id="L228">        CommonCommandArgs neighborCommand = CommonCommandArgs.fromString(args[0]);</span>

<span class="pc bpc" id="L230" title="2 of 4 branches missed.">        switch (neighborCommand) {</span>
            case ADD: {
<span class="fc" id="L232">                addNeighbor(args[1], args[2]);</span>
<span class="fc" id="L233">                break;</span>
            }
            case REMOVE: {
<span class="fc" id="L236">                removeNeighbor(args[1], args[2]);</span>
<span class="fc" id="L237">                break;</span>
            }
            case NONE: {
<span class="nc" id="L240">                System.out.println(&quot;Incorrect command&quot;);</span>
                break;
            }
        }
<span class="fc" id="L244">    }</span>

    /**
     * get continent object from name
     *
     * @param continentName
     * @return null if continent name is not existed in map
     */
    public Continent getContinentFromName(String continentName) {
<span class="fc bfc" id="L253" title="All 2 branches covered.">        for (Continent continent : GameBoard.getInstance().getGameBoardMap().getContinents()) {</span>
<span class="fc bfc" id="L254" title="All 2 branches covered.">            if (continent.getName().equals(continentName))</span>
<span class="fc" id="L255">                return continent;</span>
<span class="fc" id="L256">        }</span>

<span class="fc" id="L258">        return null;</span>
    }

    /**
     * get all continents that have no country
     *
     * @return a list of empty continent, or an empty list if all continent have countries inside
     */
    private ArrayList&lt;Continent&gt; getEmptyContinents() {
<span class="fc" id="L267">        ArrayList&lt;Continent&gt; result = new ArrayList&lt;Continent&gt;();</span>

<span class="fc bfc" id="L269" title="All 2 branches covered.">        for (Continent continent : GameBoard.getInstance().getGameBoardMap().getContinents()) {</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">            if (continent.getCountries().size() == 0) {</span>
<span class="fc" id="L271">                result.add(continent);</span>
            }
<span class="fc" id="L273">        }</span>

<span class="fc" id="L275">        return result;</span>
    }

    /**
     * get countries that not connected to any other countries
     *
     * @return a list of isolated country, or an empty list if all country is connected
     */
    private ArrayList&lt;Country&gt; getIsolatedCountries() {
<span class="fc" id="L284">        int[][] borders = GameBoard.getInstance().getGameBoardMap().getBorders();</span>
<span class="fc" id="L285">        int borderSize = borders[0].length;</span>
<span class="fc" id="L286">        ArrayList&lt;Country&gt; result = new ArrayList&lt;Country&gt;();</span>

<span class="fc bfc" id="L288" title="All 2 branches covered.">        for (int row = 0; row &lt; borderSize; row++) {</span>
<span class="fc" id="L289">            int rowSum = 0;</span>

<span class="fc bfc" id="L291" title="All 2 branches covered.">            for (int col = 0; col &lt; borderSize; col++) {</span>
<span class="fc" id="L292">                rowSum += borders[row][col];</span>
            }

<span class="fc bfc" id="L295" title="All 2 branches covered.">            if (rowSum == 0) {</span>
<span class="fc" id="L296">                result.add(GameBoard.getInstance().getGameBoardMap().getCountries().get(row));</span>
            }
        }

<span class="fc" id="L300">        return result;</span>
    }

    /**
     * check if continent with the specified name existed in map
     *
     * @param continentName
     */
    public boolean isContinentExisted(String continentName) {
<span class="fc" id="L309">        Continent continent = getContinentFromName(continentName);</span>

<span class="fc bfc" id="L311" title="All 2 branches covered.">        return continent != null;</span>
    }

    /**
     * check if country with the specified name existed in map
     *
     * @param countryName
     * @return
     */
    public boolean isCountryExisted(String countryName) {
<span class="fc" id="L321">        Country country = GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName);</span>

<span class="fc bfc" id="L323" title="All 2 branches covered.">        return country != null;</span>
    }

    /**
     * check if the number of country is lower than the minimum amount of country required currently the
     * minimum required is {@MINIMUM_AMOUNT_OF_COUNTRIES}
     *
     * @param minimumNumberOfCountries
     * @return
     */
    private boolean isNotEnoughCountries(int minimumNumberOfCountries) {
<span class="fc" id="L334">        int numberOfCountry = GameBoard.getInstance().getGameBoardMap().getCountries().size();</span>
<span class="fc bfc" id="L335" title="All 2 branches covered.">        boolean isNotEnoughCountries = numberOfCountry &lt; minimumNumberOfCountries;</span>

<span class="fc bfc" id="L337" title="All 2 branches covered.">        if (isNotEnoughCountries) {</span>
<span class="fc" id="L338">            ConsolePrinter.printFormat(&quot;Not enough countries. Created: %d - Minimum required: %s&quot;,</span>
<span class="fc" id="L339">                                       numberOfCountry,</span>
<span class="fc" id="L340">                                       minimumNumberOfCountries);</span>
        }

<span class="fc" id="L343">        return isNotEnoughCountries;</span>
    }

    /**
     * The map file stores data in blocks. This function check if the current data line is still in a
     * block or not
     *
     * @param currentLineIndex the current line index
     * @param lines            all the lines in map file
     * @return
     */
    private boolean isStillInCurrentDataBlock(int currentLineIndex, List&lt;String&gt; lines) {
<span class="fc bfc" id="L355" title="All 2 branches covered.">        if (currentLineIndex &lt; lines.size()) {</span>
<span class="fc" id="L356">            String currentLine = lines.get(currentLineIndex);</span>
<span class="pc bpc" id="L357" title="1 of 4 branches missed.">            return currentLine != &quot;&quot; &amp;&amp; currentLine.contains(&quot; &quot;);</span>
        }

<span class="fc" id="L360">        return false;</span>
    }

    /**
     * Load all border data from map file
     *
     * @param currentLineIndex the current line index
     * @param lines            all the line in map file
     * @return the line index that end the border block in map file
     */
    private int loadBordersFromFile(int currentLineIndex, List&lt;String&gt; lines) {
<span class="fc" id="L371">        int numberOfCountry = GameBoard.getInstance().getGameBoardMap().getCountries().size();</span>
<span class="fc" id="L372">        GameBoard.getInstance().getGameBoardMap().setBorders(new int[numberOfCountry][numberOfCountry]);</span>

<span class="fc bfc" id="L374" title="All 2 branches covered.">        for (int index = currentLineIndex + 1; isStillInCurrentDataBlock(index, lines); index++) {</span>
<span class="fc" id="L375">            String currentLine = lines.get(index);</span>

<span class="fc" id="L377">            String[] fragments = currentLine.split(&quot; &quot;);</span>

<span class="fc" id="L379">            int countryOrder = Integer.parseInt(fragments[0]);</span>

<span class="fc" id="L381">            int[] borderWithCountries = new int[fragments.length - 1];</span>
<span class="fc bfc" id="L382" title="All 2 branches covered.">            for (int borderIndex = 0; borderIndex &lt; borderWithCountries.length; borderIndex++) {</span>
<span class="fc" id="L383">                borderWithCountries[borderIndex] = Integer.parseInt(fragments[borderIndex + 1]);</span>
            }

<span class="fc" id="L386">            addBorders(countryOrder, borderWithCountries);</span>

<span class="fc" id="L388">            currentLineIndex = index;</span>
        }

<span class="fc" id="L391">        return currentLineIndex + 1;</span>
    }

    /**
     * Load all continent data from map file
     *
     * @param currentLineIndex the current line index
     * @param lines            all the line in map file
     * @return the line index that end the continent block in map file
     */
    private int loadContinentsFromFile(int currentLineIndex, List&lt;String&gt; lines) {
<span class="fc" id="L402">        int continentOrder = 1;</span>
<span class="fc bfc" id="L403" title="All 2 branches covered.">        for (int index = currentLineIndex + 1; isStillInCurrentDataBlock(index, lines); index++) {</span>
<span class="fc" id="L404">            String currentLine = lines.get(index);</span>
<span class="fc" id="L405">            String[] fragments = currentLine.split(&quot; &quot;);</span>
<span class="fc" id="L406">            String continentName = fragments[0];</span>
<span class="fc" id="L407">            int continentArmy = Integer.parseInt(fragments[1]);</span>

            // String continentColor = fragments[2];

<span class="fc" id="L411">            addContinent(continentName, Integer.toString(continentArmy), continentOrder);</span>

<span class="fc" id="L413">            currentLineIndex = index;</span>
<span class="fc" id="L414">            continentOrder++;</span>
        }

<span class="fc" id="L417">        return currentLineIndex + 1;</span>
    }

    /**
     * Load all country data from map file
     *
     * @param currentLineIndex the current line index
     * @param lines            all the line in map file
     * @return the line index that end the country block in map file
     */
    private int loadCountriesFromFile(int currentLineIndex, List&lt;String&gt; lines) {
<span class="fc bfc" id="L428" title="All 2 branches covered.">        for (int index = currentLineIndex + 1; isStillInCurrentDataBlock(index, lines); index++) {</span>
<span class="fc" id="L429">            String currentLine = lines.get(index);</span>

<span class="fc" id="L431">            String[] fragments = currentLine.split(&quot; &quot;);</span>

            // int countryOrder = Integer.parseInt(fragments[0]);
<span class="fc" id="L434">            String countryName = fragments[1];</span>
<span class="fc" id="L435">            int continentOrder = Integer.parseInt(fragments[2]);</span>
<span class="fc" id="L436">            int x = Integer.parseInt(fragments[3]);</span>
<span class="fc" id="L437">            int y = Integer.parseInt(fragments[4]);</span>
<span class="fc" id="L438">            Coordinate coordinate = new Coordinate(x, y);</span>

<span class="fc" id="L440">            addCountryFromMapFile(countryName, continentOrder, coordinate);</span>

<span class="fc" id="L442">            currentLineIndex = index;</span>
        }

<span class="fc" id="L445">        return currentLineIndex + 1;</span>
    }

    /**
     * load map from file
     *
     * @param fileName the exact path to map file, end with .map extension for example:
     *                 D://src/test/java/soen6441riskgame/maps/RiskEurope.map
     * @throws IOException
     */
    public void loadMap(String fileName) throws IOException {
<span class="fc" id="L456">        Path path = Paths.get(fileName);</span>

<span class="fc" id="L458">        List&lt;String&gt; lines = Files.lines(path).collect(Collectors.toList());</span>
<span class="fc" id="L459">        resetMap();</span>
<span class="fc bfc" id="L460" title="All 2 branches covered.">        for (int index = 0; index &lt; lines.size(); index++) {</span>
<span class="fc" id="L461">            String currentLine = lines.get(index);</span>
<span class="fc bfc" id="L462" title="All 2 branches covered.">            if (currentLine.startsWith(&quot;;&quot;)) {</span>
<span class="fc" id="L463">                continue;</span>
            }

<span class="fc" id="L466">            String firstWord = currentLine.split(&quot; &quot;)[0];</span>
<span class="fc" id="L467">            MapPart part = MapPart.fromString(firstWord);</span>

<span class="pc bfc" id="L469" title="All 6 branches covered.">            switch (part) {</span>
                case NAME: {
<span class="fc" id="L471">                    GameBoard.getInstance().getGameBoardMap().setMapName(currentLine.split(&quot;name&quot;)[1].trim());</span>
<span class="fc" id="L472">                    break;</span>
                }
                case FILES: {
<span class="fc" id="L475">                    break;</span>
                }
                case CONTINENTS: {
<span class="fc" id="L478">                    index = loadContinentsFromFile(index, lines);</span>
<span class="fc" id="L479">                    break;</span>
                }
                case COUNTRIES: {
<span class="fc" id="L482">                    index = loadCountriesFromFile(index, lines);</span>
<span class="fc" id="L483">                    break;</span>
                }
                case BORDERS: {
<span class="fc" id="L486">                    index = loadBordersFromFile(index, lines);</span>
<span class="fc" id="L487">                    break;</span>
                }
                case NONE: {
                    break;
                }
            }
        }

<span class="fc" id="L495">        System.out.println(&quot;Map loaded&quot;);</span>
<span class="fc" id="L496">    }</span>

    /**
     * Remove a continent from map. Remove continent will make all country inside that continent
     * invalid, thus make the map invalid.
     *
     * @param continentName name of the continent
     */
    public void removeContinent(String continentName) {
<span class="fc" id="L505">        System.out.println(&quot;Remove continent will remove all country inside that continent&quot;);</span>

<span class="fc" id="L507">        Continent continentToRemove = getContinentFromName(continentName);</span>

<span class="fc bfc" id="L509" title="All 2 branches covered.">        if (continentToRemove != null) {</span>
<span class="fc" id="L510">            String[] countriesToRemove = new String[continentToRemove.getCountries().size()];</span>

<span class="fc bfc" id="L512" title="All 2 branches covered.">            for (int index = 0; index &lt; countriesToRemove.length; index++) {</span>
<span class="fc" id="L513">                countriesToRemove[index] = continentToRemove.getCountries().get(index).getName();</span>
            }

<span class="fc bfc" id="L516" title="All 2 branches covered.">            for (String country : countriesToRemove) {</span>
<span class="fc" id="L517">                removeCountry(country);</span>
            }

<span class="fc" id="L520">            GameBoard.getInstance().getGameBoardMap().getContinents().remove(continentToRemove);</span>

<span class="fc" id="L522">            ConsolePrinter.printFormat(&quot;Continent %s is removed&quot;, continentToRemove.getName());</span>
<span class="fc" id="L523">        } else {</span>
<span class="fc" id="L524">            ConsolePrinter.printFormat(&quot;Continent %s is not existed&quot;, continentName);</span>
        }
<span class="fc" id="L526">    }</span>

    /**
     * remove a country from map, this including remove it border info and remove it from continent
     *
     * @param countryName name of the country to remove
     */
    public void removeCountry(String countryName) {
<span class="fc" id="L534">        Country country = GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName);</span>

<span class="pc bpc" id="L536" title="1 of 2 branches missed.">        if (country == null) {</span>
<span class="nc" id="L537">            ConsolePrinter.printFormat(&quot;Country %s is not existed&quot;, countryName);</span>
<span class="nc" id="L538">            return;</span>
        }

        // Remove it border
<span class="fc" id="L542">        int countryOrder = country.getOrder();</span>
<span class="fc" id="L543">        removeBorder(countryOrder - 1);</span>

        // Remove it from continent
<span class="fc" id="L546">        country.getContinent().getCountries().remove(country);</span>
        // Remove it from list country
<span class="fc" id="L548">        GameBoard.getInstance().getGameBoardMap().getCountries().remove(country);</span>
<span class="fc" id="L549">    }</span>

    /**
     * Remove border
     *
     * @param borderLocation location of the border to remove
     */
    private void removeBorder(int borderLocation) {
<span class="fc" id="L557">        int[][] originalBorder = GameBoard.getInstance().getGameBoardMap().getBorders();</span>
<span class="fc" id="L558">        int size = originalBorder[0].length - 1;</span>

<span class="fc" id="L560">        int[][] newBorders = new int[size][size];</span>

<span class="pc bpc" id="L562" title="1 of 2 branches missed.">        for (int row = 0; row &lt; borderLocation; row++) {</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">            for (int col = 0; col &lt; borderLocation; col++) {</span>
<span class="nc" id="L564">                newBorders[row][col] = originalBorder[row][col];</span>
            }
        }

<span class="fc bfc" id="L568" title="All 2 branches covered.">        for (int row = size - 1; row &gt;= borderLocation; row--) {</span>
<span class="fc bfc" id="L569" title="All 2 branches covered.">            for (int col = size - 1; col &gt;= borderLocation; col--) {</span>
<span class="fc" id="L570">                newBorders[row][col] = originalBorder[row + 1][col + 1];</span>
            }
        }

<span class="fc" id="L574">        GameBoard.getInstance().getGameBoardMap().setBorders(newBorders);</span>
<span class="fc" id="L575">    }</span>

    /**
     * remove connection between 2 countries in the borderGraph
     *
     * @param countryName
     * @param neighborCountryName
     */
    public void removeNeighbor(String countryName, String neighborCountryName) {
<span class="fc" id="L584">        Country country = GameBoard.getInstance().getGameBoardMap().getCountryFromName(countryName);</span>
<span class="fc" id="L585">        Country neighbor = GameBoard.getInstance().getGameBoardMap().getCountryFromName(neighborCountryName);</span>

<span class="pc bpc" id="L587" title="2 of 4 branches missed.">        if (country == null || neighbor == null) {</span>
<span class="nc" id="L588">            System.out.println(&quot;One or both countries is not existed&quot;);</span>
<span class="nc" id="L589">            return;</span>
        }

<span class="fc" id="L592">        GameBoard.getInstance().getGameBoardMap().getBorders()[country.getOrder() - 1][neighbor.getOrder() - 1] = 0;</span>
<span class="fc" id="L593">        GameBoard.getInstance().getGameBoardMap().getBorders()[country.getOrder() - 1][neighbor.getOrder() - 1] = 0;</span>
<span class="fc" id="L594">    }</span>

    /**
     * Reset the map, clear all continents, countries and borders
     */
    public void resetMap() {
<span class="fc" id="L600">        GameBoard.getInstance().reset();</span>
<span class="fc" id="L601">    }</span>

    public void saveMap(String fileName) throws IOException {
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">        if (!isMapValid()) {</span>
<span class="nc" id="L605">            System.out.println(&quot;Invalid map. Map not saved&quot;);</span>
<span class="nc" id="L606">            return;</span>
        }

<span class="fc" id="L609">        FileWriter writer = new FileWriter(fileName);</span>

<span class="fc" id="L611">        writeContinentsToFile(writer);</span>

<span class="fc" id="L613">        writeCountriesToFile(writer);</span>

<span class="fc" id="L615">        writeBordersToFile(writer);</span>

<span class="fc" id="L617">        writer.close();</span>
<span class="fc" id="L618">    }</span>

    /**
     * Write borders information to file
     *
     * @param writer file writer
     * @throws IOException file not found or not exist
     */
    private void writeBordersToFile(FileWriter writer) throws IOException {
<span class="fc" id="L627">        writer.write(&quot;[borders]\n&quot;);</span>

<span class="fc bfc" id="L629" title="All 2 branches covered.">        for (Country country : GameBoard.getInstance().getGameBoardMap().getCountries()) {</span>
<span class="fc" id="L630">            ArrayList&lt;Country&gt; neighbors = country.getNeighbors();</span>

<span class="fc" id="L632">            String neighborLine = Integer.toString(country.getOrder());</span>

<span class="fc bfc" id="L634" title="All 2 branches covered.">            for (Country neighbor : neighbors) {</span>
<span class="fc" id="L635">                neighborLine += &quot; &quot; + neighbor.getOrder();</span>
<span class="fc" id="L636">            }</span>

<span class="fc" id="L638">            writer.write(neighborLine + &quot;\n&quot;);</span>
<span class="fc" id="L639">        }</span>
<span class="fc" id="L640">    }</span>

    /**
     * Write countries information to file
     *
     * @param writer file writer
     * @throws IOException file not found or not exist
     */
    private void writeCountriesToFile(FileWriter writer) throws IOException {
<span class="fc" id="L649">        ArrayList&lt;Country&gt; countries = GameBoard.getInstance().getGameBoardMap().getCountries();</span>
<span class="fc" id="L650">        writer.write(&quot;[countries]\n&quot;);</span>
<span class="fc bfc" id="L651" title="All 2 branches covered.">        for (Country country : countries) {</span>
<span class="fc" id="L652">            writer.write(country.getOrder() + &quot; &quot;</span>
<span class="fc" id="L653">                         + country.getName() + &quot; &quot;</span>
<span class="fc" id="L654">                         + country.getContinent().getOrder() + &quot; &quot;</span>
<span class="fc" id="L655">                         + country.getCoordinate().getX() + &quot; &quot;</span>
<span class="fc" id="L656">                         + country.getCoordinate().getY() + &quot;\n&quot;);</span>
<span class="fc" id="L657">        }</span>
<span class="fc" id="L658">        writer.write(&quot;\n&quot;);</span>
<span class="fc" id="L659">    }</span>

    /**
     * Write continent information to file
     *
     * @param writer file writer
     * @throws IOException file not found or not exist
     */
    private void writeContinentsToFile(FileWriter writer) throws IOException {
<span class="fc" id="L668">        ArrayList&lt;Continent&gt; continents = GameBoard.getInstance().getGameBoardMap().getContinents();</span>
<span class="fc" id="L669">        writer.write(&quot;[continents]\n&quot;);</span>

<span class="fc bfc" id="L671" title="All 2 branches covered.">        for (Continent continent : continents) {</span>
<span class="fc" id="L672">            writer.write(continent.getName() + &quot; &quot; + continent.getArmy() + &quot;\n&quot;);</span>
<span class="fc" id="L673">        }</span>

<span class="fc" id="L675">        writer.write(&quot;\n&quot;);</span>
<span class="fc" id="L676">    }</span>

    /**
     * Display all continents and it's countries to console
     */
    public void showMap() {
<span class="fc" id="L682">        GameBoard.getInstance().getGameBoardMap().showContinents();</span>
<span class="fc" id="L683">    }</span>

    /**
     * add the country to country list in GameMap, and add to continent's country list in GameMap this
     * function should be remove when Dependency Injection implemented
     *
     * @param country
     * @param continent
     */
    private void updateCountryContinent(Country country, Continent continent) {
<span class="fc" id="L693">        country.addObserver(GameBoard.getInstance().getGameBoardMap().getPlayersWorldDominationView());</span>
<span class="fc" id="L694">        GameBoard.getInstance().getGameBoardMap().getCountries().add(country);</span>
<span class="fc" id="L695">        continent.getCountries().add(country);</span>
<span class="fc" id="L696">    }</span>

    /**
     * get the country that not belong to any continent
     *
     * @return list of countries
     */
    private ArrayList&lt;Country&gt; getCountriesHaveNoContinent() {
<span class="fc" id="L704">        ArrayList&lt;Country&gt; countriesWithNoContinent = new ArrayList&lt;Country&gt;();</span>
<span class="fc" id="L705">        ArrayList&lt;Country&gt; countries = GameBoard.getInstance().getGameBoardMap().getCountries();</span>

<span class="fc bfc" id="L707" title="All 2 branches covered.">        for (Country country : countries) {</span>
<span class="pc bpc" id="L708" title="1 of 2 branches missed.">            if (country.getContinent() == null) {</span>
<span class="nc" id="L709">                countriesWithNoContinent.add(country);</span>
            }
<span class="fc" id="L711">        }</span>

<span class="fc" id="L713">        return countriesWithNoContinent;</span>
    }

    /**
     * validate the map Types of errors: 1. less than 6 countries 2. some countries are isolated from
     * the rest 3. empty continents 4. one country is linked to another but no link back There is no
     * need to check for the last one, because not happened in our implementation
     *
     * @return
     */
    public boolean isMapValid() {
<span class="fc" id="L724">        boolean isNotEnoughCountries = isNotEnoughCountries(MINIMUM_AMOUNT_OF_COUNTRIES);</span>

<span class="fc bfc" id="L726" title="All 2 branches covered.">        if (isNotEnoughCountries) {</span>
<span class="fc" id="L727">            return false;</span>
        }

<span class="fc" id="L730">        ArrayList&lt;Country&gt; isolatedCountries = getIsolatedCountries();</span>
<span class="fc bfc" id="L731" title="All 2 branches covered.">        boolean isIsolatedCountryExisted = isolatedCountries.size() &gt; 0;</span>

<span class="fc" id="L733">        ArrayList&lt;Continent&gt; emptyContinents = getEmptyContinents();</span>
<span class="fc bfc" id="L734" title="All 2 branches covered.">        boolean isEmptyContinentExisted = emptyContinents.size() &gt; 0;</span>

<span class="fc" id="L736">        ArrayList&lt;Country&gt; countriesWithNoContinent = getCountriesHaveNoContinent();</span>
<span class="pc bpc" id="L737" title="1 of 2 branches missed.">        boolean isCountryWithNoContinentExisted = countriesWithNoContinent.size() &gt; 0;</span>

<span class="fc bfc" id="L739" title="All 2 branches covered.">        if (isIsolatedCountryExisted) {</span>
<span class="fc" id="L740">            System.out.println(&quot;Isolated countries existed:&quot;);</span>
<span class="fc bfc" id="L741" title="All 2 branches covered.">            for (Country country : isolatedCountries) {</span>
<span class="fc" id="L742">                country.view(1);</span>
<span class="fc" id="L743">            }</span>
        }

<span class="fc bfc" id="L746" title="All 2 branches covered.">        if (isEmptyContinentExisted) {</span>
<span class="fc" id="L747">            System.out.println(&quot;Empty continent existed:&quot;);</span>
<span class="fc bfc" id="L748" title="All 2 branches covered.">            for (Continent continent : emptyContinents) {</span>
<span class="fc" id="L749">                continent.view(1);</span>
<span class="fc" id="L750">            }</span>
        }

<span class="pc bpc" id="L753" title="1 of 2 branches missed.">        if (isCountryWithNoContinentExisted) {</span>
<span class="nc" id="L754">            System.out.println(&quot;Country that not belong to any continent existed:&quot;);</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">            for (Country country : countriesWithNoContinent) {</span>
<span class="nc" id="L756">                country.viewWithoutNeighbors(1);</span>
<span class="nc" id="L757">            }</span>
        }

        // check if country in continents are connected
<span class="fc" id="L761">        boolean isCountriesInContinentConnected = true;</span>
<span class="fc" id="L762">        ArrayList&lt;Continent&gt; continents = GameBoard.getInstance().getGameBoardMap().getContinents();</span>
<span class="fc bfc" id="L763" title="All 2 branches covered.">        for(Continent continent : continents){</span>
<span class="fc bfc" id="L764" title="All 2 branches covered.">            if(!continent.isContinentConnected()){</span>
<span class="fc" id="L765">                isCountriesInContinentConnected = false;</span>
<span class="fc" id="L766">                break;</span>
            }
<span class="fc" id="L768">        }</span>

<span class="fc" id="L770">        boolean isMapConnected = GraphChecker.isCountriesConnected(GameBoard.getInstance().getGameBoardMap().getCountries());</span>

<span class="pc bpc" id="L772" title="3 of 12 branches missed.">        return !isNotEnoughCountries</span>
               &amp;&amp; !isIsolatedCountryExisted
               &amp;&amp; !isEmptyContinentExisted
               &amp;&amp; !isCountryWithNoContinentExisted
               &amp;&amp; isCountriesInContinentConnected
               &amp;&amp; isMapConnected;
    }

    /**
     * handle the map validation command
     */
    public void validateMap() {
<span class="pc bpc" id="L784" title="1 of 2 branches missed.">        if (isMapValid()) {</span>
<span class="fc" id="L785">            System.out.println(&quot;Map valid&quot;);</span>
        } else {
<span class="nc" id="L787">            System.out.println(&quot;Invalid map&quot;);</span>
        }
<span class="fc" id="L789">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>